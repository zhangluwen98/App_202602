# App 开发与架构方法论沉淀

## 1. 前后端分离架构规范
*   **静态资源与服务隔离**: 前端静态网页（如 `mobile_preview.html`）应放置在 Vite 的 `public` 目录下，通过静态文件服务访问。后端逻辑由独立的 Node.js/Express 服务处理。
*   **API 驱动交互**: 前端通过 `fetch` 或 `axios` 调用后端 RESTful API 获取数据（如小说内容、角色状态），避免硬编码。
*   **CORS 处理**: 后端必须配置 `cors` 中间件以支持前端跨域请求，特别是在本地开发环境下。

## 2. 互动叙事系统设计 (MVP 核心)
*   **数据驱动剧情**: 使用 JSON 结构描述剧情，支持 `paragraphs`（常规段落）、`extendedParagraphs`（扩展段落）和 `dialogueTriggers`（触发器）。
*   **渐进式加载**: 避免一次性加载全部剧情，通过“点击继续”或“互动触发”来控制阅读节奏，提升沉淀感。
*   **角色发现机制 (Character Discovery)**:
    *   通过 `isDiscovered` 标志位控制角色状态。
    *   未解锁角色显示“神秘头像”与“???”姓名，引发好奇。
    *   剧情触发后动态更新角色状态，实现“从陌生到熟悉”的情感推进。

## 3. Bug 修复经验总结
*   **路径 404 问题**: Vite 项目中，静态 HTML 必须放在 `public` 目录且通过根路径访问，或在 `vite.config.js` 中配置 `base` 路径。
*   **剧情卡顿/不触发**: 检查 JSON 语法（逗号、括号匹配）以及触发器逻辑（`paragraphId` 是否匹配）。
*   **Alpine.js 响应式**: 在异步获取数据后，确保使用 `this.currentNovel = ...` 触发 UI 更新。

## 4. 可玩性与用户体验设计 (Playability & UX)
*   **心流控制 (Flow Control)**: 
    *   **分支剧情流转**: 
    *   引入 `paragraphQueue` (队列机制) 管理分支剧情 (`extendedParagraphs`)。
    *   通过 `handleChoice` 将目标段落推入队列，并逐个展示，确保阅读节奏可控。
    *   “继续剧情”按钮逻辑需兼顾主线索引 (`currentParagraphIndex`) 与分支队列状态，防止剧情在分支点中断。
*   **进度可见性**: 顶部常驻进度条提供实时反馈，减轻长篇阅读的焦虑感。
    *   **节奏切换**: 结合“自动播放”与“抉择等待”，让玩家在被动接受与主动参与间切换，维持大脑兴奋度。
*   **反馈回路 (Feedback Loops)**:
    *   **视觉奖励**: 角色解锁、好感度提升时使用全屏特效（解密动画、粒子效果），将数值变化转化为情感成就。
    *   **决策影响力**: 抉择系统不应只是装饰，需通过“分支跳转”和“角色态度转变”让玩家感受到自己的选择真实改变了世界。
*   **引导与交互**:
    *   **呼吸光效 (Pulse Effect)**: 在关键操作点（如选项按钮、继续按钮）使用微弱动画引导，降低认知负荷。
    *   **平滑过渡**: 章节结束处的显式引导按钮能有效防止用户流失，确保心流连续。

## 5. 提升开发效率的提示词优化
*   **上下文关联**: 在提示词中明确提及 PRD、数据结构定义和现有组件，确保 AI 生成的代码符合既定规范。
*   **功能拆解**: 将复杂交互（如剧情触发系统）拆分为“数据模型设计”、“后端接口实现”、“前端逻辑控制”三个步骤。
*   **验证驱动**: 要求 AI 在完成功能后提供验证方案（如本地预览链接、测试用例）。
