| Panel Group | Panel Title | Description | Principle Explanation | Tuning Role & Usage | Query/Expression |
|---|---|---|---|---|---|
| PD Performance | PD Instance | PD 实例数量 | 统计当前 PromQL 查询范围内（按 Label 分组）存活的 PD 实例（Prefill/Decode 角色）的总数。 | **可用性监控**：用于确认集群规模是否符合预期。如果数量异常下降，提示 Pod Crash、被驱逐或调度异常，需立即介入排查 K8s 状态。 | `count(     group by (label0,label1) (         label_replace(             label_replace(                 label_replace(                     sum by (exported_endpoint)(                         glm_watched_endpoints{region=~"$region",job=~"$namespace/$app-lb",cluster="",pool =~ "^$\|^($pool1);($pool2);($pool3);;;$"}                     ) > 0,                     "label0", "$1",                     "exported_endpoint", "^([^:]+):([^:]+)(?::([^:]+))?$"                     ),                 "label1", "$2",                 "exported_endpoint", "^([^:]+):([^:]+)(?::([^:]+))?$"             ),             "label2", "$3",         "exported_endpoint", "^([^:]+):([^:]+)(?::([^:]+))?$"         )     ) )` |
| PD Performance | PD Instance | PD 实例数量 | 统计当前 PromQL 查询范围内（按 Label 分组）存活的 PD 实例（Prefill/Decode 角色）的总数。 | **可用性监控**：用于确认集群规模是否符合预期。如果数量异常下降，提示 Pod Crash、被驱逐或调度异常，需立即介入排查 K8s 状态。 | `count by (label0)(     count by (label0,label1) (         label_replace(             label_replace(                 label_replace(                     sum by (exported_endpoint)(                         glm_watched_endpoints{region=~"$region",job=~"$namespace/$app-lb",cluster="",pool =~ "^$\|^($pool1);($pool2);($pool3);;;$"}                     ) > 0,                     "label0", "$1",                     "exported_endpoint", "^([^:]+):([^:]+)(?::([^:]+))?$"                     ),                 "label1", "$2",                 "exported_endpoint", "^([^:]+):([^:]+)(?::([^:]+))?$"             ),             "label2", "$3",         "exported_endpoint", "^([^:]+):([^:]+)(?::([^:]+))?$"         )     ) )` |
| PD Performance | Pods by dprank | 按 DP Rank 分组的 Pod 数量 | 根据 Pipeline Parallelism (PP) 或 Data Parallelism (DP) 的 Rank 统计 Pod 分布情况。 | **负载均衡校验**：确保各个 Rank 的 Pod 数量均匀。如果不均匀，可能导致某些 Rank 成为瓶颈，拖慢整体流水线效率。 | `count(sum(glm_watched_endpoints{region=~"$region",job=~"$namespace/$app-lb",cluster="",pool =~ "^$\|^($pool1);($pool2);($pool3);;;$"}) by (exported_endpoint) > 0)` |
| PD Performance | Pods by dprank | 按 DP Rank 分组的 Pod 数量 | 根据 Pipeline Parallelism (PP) 或 Data Parallelism (DP) 的 Rank 统计 Pod 分布情况。 | **负载均衡校验**：确保各个 Rank 的 Pod 数量均匀。如果不均匀，可能导致某些 Rank 成为瓶颈，拖慢整体流水线效率。 | `count by (label0) (     label_replace(         label_replace(             label_replace(                 sum by (exported_endpoint)(                     glm_watched_endpoints{region=~"$region",job=~"$namespace/$app-lb",cluster="",pool =~ "^$\|^($pool1);($pool2);($pool3);;;$"}                 ) > 0,                 "label0", "$1",                 "exported_endpoint", "^([^:]+):([^:]+)(?::([^:]+))?$"                 ),             "label1", "$2",             "exported_endpoint", "^([^:]+):([^:]+)(?::([^:]+))?$"         ),         "label2", "$3",     "exported_endpoint", "^([^:]+):([^:]+)(?::([^:]+))?$"     ) )` |
| PD Performance | [Prefill] E2E Request Latency in $region | Prefill 端到端请求延迟 | 统计 Prefill 阶段处理请求的 P99/平均 耗时。涵盖从请求到达 Prefill 实例到 KV Cache 传输完成的全过程。 | **核心 SLA 指标**：直接影响首字延迟（TTFT）。<br>1. 若延迟高，检查 Input Token 长度是否过长。<br>2. 检查计算资源（GPU）是否饱和。<br>3. 检查与 Decode 间的网络传输是否阻塞。 | `sum by (job)(rate(sglang:e2e_request_latency_seconds_sum{region=~"$region",cluster="",job=~"$namespace/$app-prefill"}[$__rate_interval]))  / sum by (job)(rate(sglang:e2e_request_latency_seconds_count{region=~"$region",cluster="",job=~"$namespace/$app-prefill"}[$__rate_interval]))` |
| PD Performance | [Prefill] SGL Request | Prefill 请求处理数量 | 统计 Prefill 实例接收并处理的请求速率（QPS）。 | **流量监控**：反映系统负载压力。结合 Latency 指标看，若 QPS 升高导致 Latency 恶化，说明系统达到容量瓶颈，需扩容。 | `sum(     rate(         sglang:num_requests_total{region=~"$region",job=~"$namespace/$app-prefill",cluster=""}[$__rate_interval]     ) ) by (region)` |
| PD Performance | [Decode] Time To First Token | 首字延迟（TTFT） | 从用户发送请求到收到第一个 Token 的时间间隔。在 PD 分离架构中，包含 Prefill 计算 + KV Cache 传输 + Decode 首次推理。 | **用户体验核心指标**：<br>1. **高 TTFT** 通常由 Prefill 慢或传输慢导致。<br>2. 需对比 Prefill Latency 和 Transfer Latency 定位瓶颈环节。 | `histogram_quantile( 0.99,   sum by (le) (       rate(         sglang:time_to_first_token_seconds_bucket       {cluster="",job=~"$namespace/$app-decode",region=~"$region"}[1m]       )   ) )` |
| PD Performance | [Decode] First Token Latency (By Cluster) | 首字延迟（按集群统计） | 按集群维度聚合的 TTFT 指标。 | **多集群对比**：用于发现特定集群的硬件或网络问题。若某集群显著慢于其他集群，需排查该集群的基础设施。 | `sum(rate(sglang:time_to_first_token_seconds_sum{region=~"$region",cluster="",job=~"$namespace/$app-decode"}[$__rate_interval])) by (region) / sum(rate(sglang:time_to_first_token_seconds_count{region=~"$region",cluster="",job=~"$namespace/$app-decode"}[$__rate_interval])) by (region) * 1000` |
| PD Performance | [Decode] E2E Request Latency in $region | Decode 端到端请求延迟 | 统计请求在 Decode 阶段的耗时（从接收 KV Cache 到生成结束）。 | **生成性能监控**：主要受 Output Token 长度影响。若单位 Token 耗时（TPOT）过高，说明 Decode 算力不足或显存带宽受限。 | `histogram_quantile(0.99, sum by(le) (rate(sglang:e2e_request_latency_seconds_bucket{region=~"$region",cluster="",job=~"$namespace/$app-decode"}[$__rate_interval])))` |
| PD Performance | [Decode] SGL Request | Decode 请求处理数量 | 统计 Decode 实例处理的请求速率。 | **负载均衡**：应与 Prefill 请求数大致匹配。若偏差较大，可能存在请求路由丢失或统计口径不一致。 | `sum(     rate(         sglang:num_requests_total{region=~"$region",job=~"$namespace/$app-decode",cluster=""}[$__rate_interval]     ) ) by (region)` |
| PD Performance | [Decode] Inter Token Latency | Token 间延迟 (ITL) | Decode 阶段生成相邻两个 Token 之间的时间间隔（Time Per Output Token）。 | **吞吐与延迟的权衡**：<br>1. **高 ITL** 意味着生成慢，用户感觉“卡顿”。<br>2. 原因通常是 Batch Size 过大导致计算延迟增加，或显存带宽瓶颈。<br>3. 需调整 Max Batch Size 或使用推测解码优化。 | `sum(rate(sglang:inter_token_latency_seconds_sum{region=~"$region",cluster="",job=~"$namespace/$app-decode"}[$__rate_interval]))  / sum(rate(sglang:inter_token_latency_seconds_count{region=~"$region",cluster="",job=~"$namespace/$app-decode"}[$__rate_interval])) * 1000` |
| PD Performance | [Decode] Inter Token Latency (By Cluster) | Token 间延迟（按集群统计） | 按集群维度聚合的 ITL 指标。 | **集群性能基线**：用于对比不同 GPU 型号或网络环境下的生成效率。 | `sum(rate(sglang:inter_token_latency_seconds_sum{region=~"$region",cluster="",job=~"$namespace/$app-prefill"}[$__rate_interval])) by (region) / sum(rate(sglang:inter_token_latency_seconds_count{region=~"$region",cluster="",job=~"$namespace/$app-prefill"}[$__rate_interval])) by (region) * 1000` |
| PD Performance | [Prefill] Running Requests in $region | Prefill 正在运行的请求数 | 当前时刻 Prefill 实例正在并发处理的请求数量。 | **并发度监控**：<br>1. 若接近 Max Concurrency 上限，新请求将进入队列。<br>2. 结合显存使用率，判断是否还有提升 Batch Size 的空间。 | `avg(     sglang:num_running_reqs{region=~"$region",job=~"$namespace/$app-prefill",cluster=""} )` |
| PD Performance | [Prefill] Running Request | Prefill 正在运行的请求数（按 Pod 统计） | 单 Pod 维度的并发请求数。 | **负载不均排查**：检查是否有热点 Pod。若某 Pod 负载过高，可能是路由算法（Load Balancer）问题。 | `max(sglang:num_running_reqs{region=~"$region",job=~"$namespace/$app-prefill",cluster=""}) by (pod)` |
| PD Performance | [Prefill] Avg Queue Size | Prefill 平均队列大小 | Prefill 实例内部等待调度的请求数量。 | **饱和度告警**：<br>1. **Queue > 0** 意味着系统过载。<br>2. 短期堆积可容忍，长期堆积需扩容或限流。 | `avg(sglang:num_queue_reqs{region=~"$region",job=~"$namespace/$app-prefill",cluster=""})` |
| PD Performance | [Prefill] Queue Size | Prefill 队列大小（按 Pod 统计） | 单 Pod 维度的等待队列长度。 | **单点故障排查**：若仅个别 Pod 队列高，可能是该 Pod 卡死或处理慢请求（Long Context）。 | `max(sglang:num_queue_reqs{region=~"$region",job=~"$namespace/$app-prefill",cluster=""}) by (pod)` |
| PD Performance | [Decode] Running Requests in $region | Decode 正在运行的请求数 | Decode 实例当前的并发请求数。 | **Batch Size 调优**：Decode 的并发数直接决定 Batch Size。并发越高，吞吐越大，但 ITL 可能变差。需寻找最佳平衡点。 | `avg(     sglang:num_running_reqs{region=~"$region",job=~"$namespace/$app-decode",cluster=""} )` |
| PD Performance | [Decode] Running Request | Decode 正在运行的请求数（按 Pod 统计） | 单 Pod 维度的 Decode 并发数。 | **路由均衡性**：确保请求均匀分发到各 Decode 实例。 | `max(sglang:num_running_reqs{region=~"$region",job=~"$namespace/$app-decode",cluster=""}) by (pod)` |
| PD Performance | [Decode] Avg Queues Size | Decode 平均队列大小 | Decode 实例等待调度的请求数。 | **Decode 瓶颈**：若 Decode 队列堆积，说明生成速度跟不上请求到达速度。需增加 Decode 实例。 | `avg(sglang:num_queue_reqs{region=~"$region",job=~"$namespace/$app-decode",cluster=""})` |
| PD Performance | [Decode] Transfer Queue Size | Decode 传输队列大小（按 Pod 统计） | 等待从 Prefill 接收 KV Cache 的请求数量。 | **传输阻塞**：若此队列高，说明网络传输是瓶颈，或 Decode 接收处理过慢。 | `max(sglang:num_decode_transfer_queue_reqs{region=~"$region",job=~"$namespace/$app-decode",cluster=""}) by (pod)` |
| PD Performance | [Prefill] Queue Size By Instance | Prefill 队列大小（按实例统计） | 各 Prefill 实例的请求积压情况。 | **细粒度负载监控**：用于定位具体哪个实例是短板。 | `avg by (pod)(sglang:num_queue_reqs{region=~"$region",job=~"$namespace/$app-prefill",cluster=""})` |
| PD Performance | [Prefill] Pre-Alloc Queue Size By Instance | Prefill 预分配队列大小（按实例统计） | 等待预分配显存/KV Cache Block 的请求数。 | **显存碎片/不足**：若此队列高，说明显存不足以容纳新请求，需优化内存管理或减少并发。 | `avg by (pod)(sglang:num_prefill_prealloc_queue_reqs{region=~"$region",job=~"$namespace/$app-prefill",cluster=""})` |
| PD Performance | [Prefill] Inflight Queue Size By Instance | Prefill 传输中队列大小（按实例统计） | 正在进行 KV Cache 传输的请求数。 | **网络并发控制**：限制同时传输的请求数以避免网络拥塞。 | `avg by (pod) (sglang:num_prefill_inflight_queue_reqs{region=~"$region",job=~"$namespace/$app-prefill",cluster=""})` |
| PD Performance | [Decode] Queue Size | Decode 队列大小（按 Pod 统计） | Decode 实例的等待队列。 | **资源不足**：直接反映 Decode 算力缺口。 | `sum by (pod) (sglang:num_queue_reqs{region=~"$region",job=~"$namespace/$app-decode",cluster=""})` |
| PD Performance | [Decode] Pre-Alloc Queue Size | Decode 预分配队列大小（按 Pod 统计） | Decode 端等待分配 KV Cache 插槽的请求数。 | **KV Cache 容量瓶颈**：Decode 显存耗尽，无法接纳新请求。需增加 RadixAttention 显存比例或缩短 Context。 | `sum by (pod)(sglang:num_decode_prealloc_queue_reqs{region=~"$region",job=~"$namespace/$app-decode",cluster=""})` |
| PD Performance | [Decode] Transfer Queue Size | Decode 传输队列大小（按 Pod 统计） | 等待从 Prefill 接收 KV Cache 的请求数量。 | **传输阻塞**：若此队列高，说明网络传输是瓶颈，或 Decode 接收处理过慢。 | `sum by (pod) (sglang:num_decode_transfer_queue_reqs{region=~"$region",job=~"$namespace/$app-decode",cluster=""})` |
| PD Performance | [Prefill] Bootstrap Latency | Prefill 启动延迟 | 请求进入 Prefill 系统到开始计算的耗时（包含参数解析、分词等）。 | **框架开销**：若过高，说明 Serving 框架（如 SGLang/vLLM）的调度器或 Python 逻辑有性能问题。 | `avg(rate(sglang:per_stage_req_latency_seconds_sum{region=~"$region",job=~"$namespace/$app-prefill",stage="prefill_bootstrap"})[$__interval] / rate(sglang:per_stage_req_latency_seconds_count{region=~"$region",job=~"$namespace/$app-prefill",stage="prefill_bootstrap"})[$__interval])` |
| PD Performance | [Prefill] Waiting Latency | Prefill 等待延迟 | 请求在队列中等待调度的时间。 | **排队效应**：直接受并发度限制影响。若高，说明资源忙，需扩容。 | `avg(rate(sglang:per_stage_req_latency_seconds_sum{region=~"$region",job=~"$namespace/$app-prefill",stage="prefill_waiting"})[$__interval] / rate(sglang:per_stage_req_latency_seconds_count{region=~"$region",job=~"$namespace/$app-prefill",stage="prefill_waiting"})[$__interval])` |
| PD Performance | [Prefill] Forward Latency | Prefill 转发延迟 | GPU 执行模型前向传播（Forward Pass）的时间。 | **计算瓶颈**：<br>1. 与 Input Token 长度成平方/线性关系。<br>2. 若异常高，检查 GPU 频率或 Kernel 优化（FlashAttention）。 | `avg(rate(sglang:per_stage_req_latency_seconds_sum{region=~"$region",job=~"$namespace/$app-prefill",stage="prefill_forward"})[$__interval] / rate(sglang:per_stage_req_latency_seconds_count{region=~"$region",job=~"$namespace/$app-prefill",stage="prefill_forward"})[$__interval])` |
| PD Performance | [Prefill] Transfer KV Cache Latency | Prefill KV Cache 传输延迟 | 将 KV Cache 数据通过网络发送给 Decode 的耗时。 | **PD 分离核心瓶颈**：<br>1. 检查网络带宽（IB/RoCE）。<br>2. 检查序列化/压缩效率。<br>3. 优化传输协议（如使用 RDMA）。 | `avg(rate(sglang:per_stage_req_latency_seconds_sum{region=~"$region",job=~"$namespace/$app-prefill",stage="prefill_transfer_kv_cache"})[$__interval] / rate(sglang:per_stage_req_latency_seconds_count{region=~"$region",job=~"$namespace/$app-prefill",stage="prefill_transfer_kv_cache"})[$__interval])` |
| PD Performance | [Decode] Prepare Latency | Decode 准备延迟 | Decode 实例接收请求前的准备工作耗时。 | **调度开销**：通常较短。若长，检查控制面通信延迟。 | `avg(rate(sglang:per_stage_req_latency_seconds_sum{region=~"$region",job=~"$namespace/$app-decode",stage="decode_prepare"})[$__interval] / rate(sglang:per_stage_req_latency_seconds_count{region=~"$region",job=~"$namespace/$app-decode",stage="decode_prepare"})[$__interval])` |
| PD Performance | [Decode] Bootstrap Latency | Decode 启动延迟 | Decode 实例初始化请求状态的耗时。 | **状态管理开销**：涉及 KV Cache 的加载和索引构建。 | `avg(rate(sglang:per_stage_req_latency_seconds_sum{region=~"$region",job=~"$namespace/$app-decode",stage="decode_bootstrap"})[$__interval] / rate(sglang:per_stage_req_latency_seconds_count{region=~"$region",job=~"$namespace/$app-decode",stage="decode_bootstrap"})[$__interval])` |
| PD Performance | [Decode] Transferred Latency | Decode 传输延迟 | Decode 端视角下的 KV Cache 接收耗时（包含等待 Prefill 发送的时间）。 | **端到端传输监控**：若远大于 Prefill 的 Transfer Latency，说明存在网络排队或 Decode 接收端处理慢。 | `avg(rate(sglang:per_stage_req_latency_seconds_sum{region=~"$region",job=~"$namespace/$app-decode",stage="decode_transferred"})[$__interval] / rate(sglang:per_stage_req_latency_seconds_count{region=~"$region",job=~"$namespace/$app-decode",stage="decode_transferred"})[$__interval])` |
| PD Performance | [Decode] Waiting Latency | Decode 等待延迟 | 请求在 Decode 队列中等待加入 Batch 的时间。 | **调度策略优化**：若高，说明 Decode 忙于处理现有 Batch，无法插入新请求（Continuous Batching 策略）。 | `avg(rate(sglang:per_stage_req_latency_seconds_sum{region=~"$region",job=~"$namespace/$app-decode",stage="decode_waiting"})[$__interval] / rate(sglang:per_stage_req_latency_seconds_count{region=~"$region",job=~"$namespace/$app-decode",stage="decode_waiting"})[$__interval])` |
| PD Performance | [Prefill] Bootstrap Latency By Instance | Prefill 启动延迟（按实例统计） | 单实例维度的启动延迟。 | **异常节点检测**：排除个别节点 CPU 负载过高导致的调度慢。 | `avg by (pod) (rate(sglang:per_stage_req_latency_seconds_sum{region=~"$region",job=~"$namespace/$app-prefill",stage="prefill_bootstrap"})[$__rate_interval] / rate(sglang:per_stage_req_latency_seconds_count{region=~"$region",job=~"$namespace/$app-prefill",stage="prefill_bootstrap"})[$__rate_interval])` |
| PD Performance | [Prefill] Forward Latency By Instance | Prefill 转发延迟（按实例统计） | 单实例维度的计算延迟。 | **GPU 性能一致性**：检查是否有 GPU 降频或散热问题。 | `avg by (pod) (rate(sglang:per_stage_req_latency_seconds_sum{region=~"$region",job=~"$namespace/$app-prefill",stage="prefill_forward"})[$__interval] / rate(sglang:per_stage_req_latency_seconds_count{region=~"$region",job=~"$namespace/$app-prefill",stage="prefill_forward"})[$__interval])` |
| PD Performance | [Prefill] Wait Latency By Instance | Prefill 等待延迟（按实例统计） | 单实例维度的排队延迟。 | **负载分布**：验证请求分发算法是否导致某些实例排队更久。 | `avg by (pod) (rate(sglang:per_stage_req_latency_seconds_sum{region=~"$region",job=~"$namespace/$app-prefill",stage="prefill_waiting"})[$__interval] / rate(sglang:per_stage_req_latency_seconds_count{region=~"$region",job=~"$namespace/$app-prefill",stage="prefill_waiting"})[$__interval])` |
| PD Performance | [Prefill] Transfer Latency By Instance | Prefill 传输延迟（按实例统计） | 单实例维度的传输延迟。 | **网络故障定位**：定位特定物理机或网卡的网络问题。 | `avg by (pod) (rate(sglang:per_stage_req_latency_seconds_sum{region=~"$region",job=~"$namespace/$app-prefill",stage="prefill_transfer_kv_cache"})[$__interval] / rate(sglang:per_stage_req_latency_seconds_count{region=~"$region",job=~"$namespace/$app-prefill",stage="prefill_transfer_kv_cache"})[$__interval])` |
| PD Performance | [Decode] Transferred Latency By Instance | Decode 传输延迟（按实例统计） | 单实例维度的接收延迟。 | **接收端网络分析**：检查 Decode 节点的网络入口带宽。 | `avg by (pod) (rate(sglang:per_stage_req_latency_seconds_sum{region=~"$region",job=~"$namespace/$app-decode",stage="decode_transferred"})[$__interval] / rate(sglang:per_stage_req_latency_seconds_count{region=~"$region",job=~"$namespace/$app-decode",stage="decode_transferred"})[$__interval])` |
| PD Performance | [Prefill] Token Usage in $region | Prefill Token 使用率 | Prefill 实例 KV Cache 内存池的占用百分比。 | **内存安全线**：<br>1. 保持在 80%-90% 为佳。<br>2. 100% 会触发 Eviction（驱逐），导致重计算，严重拖慢性能。<br>3. 过低则浪费显存。 | `avg(sglang:token_usage{region=~"$region",job=~"$namespace/$app-prefill",cluster=""})` |
| PD Performance | [Prefill] Token Usage (By Cluster) | Prefill Token 使用率（按集群统计） | 集群维度的平均 Token 使用率。 | **容量规划**：判断整个集群显存资源是否紧缺。 | `avg(sglang:token_usage{region=~"$region",job=~"$namespace/$app-prefill",cluster=""}) by (region)` |
| PD Performance | [Prefill] Token Usage | Prefill Token 使用率（按 Pod 统计） | 单 Pod 的显存占用率。 | **OOM 预警**：防止个别 Pod 显存打满而 Crash。 | `max(sglang:token_usage{region=~"$region",job=~"$namespace/$app-prefill",cluster=""}) by (pod, region)` |
| PD Performance | [Prefill] Cached Tokens | Prefill 缓存 Token 数量速率 | 系统中被缓存的 Token 总量变化速率。 | **缓存效益分析**：结合 HitRate 使用，评估 RadixAttention 的效果。 | `sum(rate(sglang:cached_tokens_total{region=~"$region",job=~"$namespace/$app-prefill",cluster=""}[$__rate_interval]))` |
| PD Performance | [Decode] Token Usage in $region | Decode Token 使用率 | Decode 实例 KV Cache 内存池占用率。 | **长文本支持能力**：<br>1. Decode 显存占用随生成的 Token 数增长。<br>2. 若频繁打满，限制了最大并发数或最大生成长度。 | `avg(sglang:token_usage{region=~"$region",job=~"$namespace/$app-decode",cluster=""})` |
| PD Performance | [Decode] Token Usage (By Cluster) | Decode Token 使用率（按集群统计） | 集群维度的 Decode 显存使用情况。 | **资源分配**：决定是否需要分配更多显存给 KV Cache（相对于权重）。 | `avg(sglang:token_usage{region=~"$region",job=~"$namespace/$app-decode",cluster=""}) by (region)` |
| PD Performance | [Decode] Token Usage | Decode Token 使用率（按 Pod 统计） | 单 Pod 显存使用率。 | **稳定性监控**：监控显存泄漏或碎片化问题。 | `max(sglang:token_usage{region=~"$region",job=~"$namespace/$app-decode",cluster=""}) by (pod, region)` |
| PD Performance | [Prefill] Prefix Cache HitRate | Prefill 前缀缓存命中率 | 请求 Prompt 命中 KV Cache 前缀缓存（RadixAttention）的比例。 | **性能倍增器**：<br>1. 命中率高能显著降低 Prefill Latency 和计算量。<br>2. 调优：通过请求路由优化（将相同前缀发往同一实例）来提升命中率。 | `avg(sglang:cache_hit_rate{region=~"$region",cluster="",job=~"$namespace/$app-prefill"})` |
| PD Performance | [Prefill] Prefill Throughput in $region | Prefill 吞吐量 | 单位时间处理的 Prompt Token 总数 (Tokens/s)。 | **系统算力上限**：反映集群整体的 Prompt 处理能力。受限于 GPU FLOPs 和显存带宽。 | `sum(rate(sglang:prompt_tokens_total{region=~"$region",job=~"$namespace/$app-prefill",cluster=""}[$__rate_interval]))` |
| PD Performance | [Prefill] Token Throughput / Instance (by Cluster) | Prefill 单实例 Token 吞吐量 | 平均每个实例的处理吞吐量。 | **单卡效率**：评估不同硬件（如 A100 vs H100）的实际表现。 | `avg(rate(sglang:prompt_tokens_total{region=~"$region",job=~"$namespace/$app-prefill",cluster=""}[$__rate_interval])) by (region)` |
| PD Performance | [Prefill] Thoughput | Prefill 吞吐量（按 Pod 统计） | 单 Pod 吞吐量。 | **异常检测**：发现吞吐量异常低的“慢节点”。 | `avg(rate(sglang:prompt_tokens_total{region=~"$region",job=~"$namespace/$app-prefill",cluster=""}[$__rate_interval])) by (pod, region)` |
| PD Performance | [Decode] Aborted Requests (by Cluster) | Decode 中止请求数 | 客户端断开或超时的请求数量。 | **服务质量 (QoS)**：<br>1. 飙升通常意味着服务端处理过慢导致客户端超时。<br>2. 需排查 Latency 升高原因。 | `sum(     rate(sglang:num_aborted_requests_total{region=~"$region",job=~"$namespace/$app-decode",cluster=""}[$__rate_interval]) ) by (region)` |
| PD Performance | [Prefill] Aborted Requests (by Cluster) | Prefill 中止请求数 | Prefill 阶段中止的请求。 | **早期失败**：若请求在 Prefill 就中止，可能是队列积压太久。 | `sum(     rate(sglang:num_aborted_requests_total{region=~"$region",job=~"$namespace/$app-prefill",cluster=""}[$__rate_interval]) ) by (region)` |
| PD Performance | [Decode] Generation Throughput in $region | Decode 生成吞吐量 | 单位时间生成的 Token 总数 (Tokens/s)。 | **生成能力指标**：反映集群对外的服务产出能力。 | `avg(rate(sglang:generation_tokens_total{region=~"$region",job=~"$namespace/$app-decode",cluster=""}[$__rate_interval]))` |
| PD Performance | [Decode] Throughput / Instance (by Cluster) | Decode 单实例吞吐量 | 平均单实例的生成速率。 | **效率基准**：用于 Capacity Planning（容量规划）。 | `avg(     sglang:gen_throughput{region=~"$region",job=~"$namespace/$app-decode",cluster=""} ) by (region)` |
| PD Performance | [Decode] Thoughput | Decode 吞吐量（按 Pod 统计） | 单 Pod 生成速率。 | **节点健康度**：低吞吐可能意味着 GPU 故障或网络卡顿。 | `avg(rate(sglang:prompt_tokens_total{region=~"$region",job=~"$namespace/$app-decode",cluster=""}[$__rate_interval])) by (pod, region)` |
| PD Performance | [Decode] Retracted Requests (by Cluster) | Decode 撤回请求数 | 被系统主动撤回（Retract）的请求，通常发生在 KV Cache 抢占/重计算场景。 | **系统颠簸**：<br>1. 出现此指标说明显存严重不足，正在发生“颠簸”。<br>2. 必须降低并发或扩容。 | `sum(     rate(sglang:total_retracted_reqs{region=~"$region",job=~"$namespace/$app-prefill",cluster=""}[$__rate_interval]) ) by (region)` |
| PD Performance | [Prefill] Avg iB Xmit Speed | Prefill 平均 IB 发送速度 | InfiniBand 网卡的发送带宽（Gbps）。主要流量是 KV Cache 传输。 | **网络瓶颈监控**：<br>1. 若接近网卡物理上限（如 200Gbps/400Gbps），将成为硬瓶颈。<br>2. 需启用压缩或升级网络。 | `avg(     sum by (region,node) (irate(         node_infiniband_port_data_transmitted_bytes_total{         region=~"$region", device=~"mlx5_.*"         }[$__rate_interval]     ) * 8)     * on(node) group_right(pod, namespace)     (         kube_pod_info{region=~"$region"}         and on(pod, namespace)         (         kube_pod_owner{owner_kind="ReplicaSet", region=~"$region"}         and on(owner_name, namespace)         label_replace(             kube_replicaset_owner{             owner_kind="Deployment", namespace=~"$namespace", region=~"$region", owner_name=~"$app-prefill",             },             "owner_name", "$1", "replicaset", "(.*)"         )         )     ) ) by (region, namespace, owner_name)` |
| PD Performance | [Prefill] Avg iB Xmit Packet Rate | Prefill 平均 IB 发送包速率 | InfiniBand 网卡的发送包速率（PPS）。 | **小包问题**：<br>1. 若带宽不高但 PPS 很高，说明存在大量小包。<br>2. 高 PPS 消耗 CPU，可能导致丢包。需优化传输 Batching。 | `avg(     sum by (region,node) (irate(         node_infiniband_port_packets_transmitted_total{         region=~"$region", device=~"mlx5_.*"         }[$__rate_interval]     ))     * on(node) group_right(pod, namespace)     (         kube_pod_info{region=~"$region"}         and on(pod, namespace)         (         kube_pod_owner{owner_kind="ReplicaSet", region=~"$region"}         and on(owner_name, namespace)         label_replace(             kube_replicaset_owner{             owner_kind="Deployment", namespace=~"$namespace", region=~"$region", owner_name=~"$app-prefill",             },             "owner_name", "$1", "replicaset", "(.*)"         )         )     ) ) by (region, namespace, owner_name)` |
| PD Performance | [Prefill] Avg iB Xmit Speed | Prefill 平均 IB 发送速度 | InfiniBand 网卡的发送带宽（Gbps）。主要流量是 KV Cache 传输。 | **网络瓶颈监控**：<br>1. 若接近网卡物理上限（如 200Gbps/400Gbps），将成为硬瓶颈。<br>2. 需启用压缩或升级网络。 | `avg(     sum by (region,node) (irate(         node_infiniband_port_data_transmitted_bytes_total{         region=~"$region", device=~"mlx5_.*"         }[$__rate_interval]     ) * 8)     * on(node) group_left(pod, namespace)     (         kube_pod_info{region=~"$region"}         and on(pod, namespace)         (         kube_pod_owner{owner_kind="ReplicaSet", region=~"$region"}         and on(owner_name, namespace)         label_replace(             kube_replicaset_owner{             owner_kind="Deployment", namespace=~"$namespace", region=~"$region", owner_name=~"$app-prefill",             },             "owner_name", "$1", "replicaset", "(.*)"         )         )     ) ) by (region, namespace, pod)` |
| PD Performance | [Decode] Accept Length Of Speculative | 投机解码平均接受长度 | 在使用投机解码（Speculative Decoding）时，大模型平均每次验证通过的小模型 Token 数量。 | **加速比评估**：<br>1. 长度越大，加速效果越好。<br>2. 若长度接近 0，说明投机解码失效，反而增加开销，应关闭。 | `avg by (region) (sglang:spec_accept_length{region=~"$region",job=~"$namespace/$app-decode",cluster=""})` |
| PD Performance | [Decode] Avg iB Recv Speed | Decode 平均 IB 接收速度 | Decode 节点接收数据的带宽。主要来自 Prefill 的 KV Cache。 | **下游带宽监控**：确保 Decode 节点的接收能力不低于 Prefill 的发送能力。 | `avg(     sum by (region,node) (irate(         node_infiniband_port_data_received_bytes_total{         region=~"$region", device=~"mlx5_.*"         }[$__rate_interval]     ) * 8)     * on(node) group_right(pod, namespace)     (         kube_pod_info{region=~"$region"}         and on(pod, namespace)         (         kube_pod_owner{owner_kind="ReplicaSet", region=~"$region"}         and on(owner_name, namespace)         label_replace(             kube_replicaset_owner{             owner_kind="Deployment", namespace=~"$namespace", region=~"$region", owner_name=~"$app-decode",             },             "owner_name", "$1", "replicaset", "(.*)"         )         )     ) ) by (region, namespace, owner_name)` |
| PD Performance | [Decode] Avg iB Recv Packet Rate | Decode 平均 IB 接收包速率 | Decode 节点的接收包速率。 | **软中断负载**：高 PPS 可能导致 ksoftirqd 占用 CPU 过高，影响推理线程。 | `avg(     sum by (region,node) (irate(         node_infiniband_port_packets_received_total{         region=~"$region", device=~"mlx5_.*"         }[$__rate_interval]     ))     * on(node) group_right(pod, namespace)     (         kube_pod_info{region=~"$region"}         and on(pod, namespace)         (         kube_pod_owner{owner_kind="ReplicaSet", region=~"$region"}         and on(owner_name, namespace)         label_replace(             kube_replicaset_owner{             owner_kind="Deployment", namespace=~"$namespace", region=~"$region", owner_name=~"$app-decode",             },             "owner_name", "$1", "replicaset", "(.*)"         )         )     ) ) by (region, namespace, owner_name)` |
| PD Performance | [Decode] Avg iB Recv Speed | Decode 平均 IB 接收速度 | Decode 节点接收数据的带宽。主要来自 Prefill 的 KV Cache。 | **下游带宽监控**：确保 Decode 节点的接收能力不低于 Prefill 的发送能力。 | `avg(     sum by (region,node) (irate(         node_infiniband_port_data_received_bytes_total{         region=~"$region", device=~"mlx5_.*"         }[$__rate_interval]     ) * 8)     * on(node) group_left(pod, namespace)     (         kube_pod_info{region=~"$region"}         and on(pod, namespace)         (         kube_pod_owner{owner_kind="ReplicaSet", region=~"$region"}         and on(owner_name, namespace)         label_replace(             kube_replicaset_owner{             owner_kind="Deployment", namespace=~"$namespace", region=~"$region", owner_name=~"$app-decode",             },             "owner_name", "$1", "replicaset", "(.*)"         )         )     ) ) by (region, namespace, pod)` |
| PD Performance | [Prefill] Queue Lantency | Prefill 平均请求队列延迟 | 最近采样周期内，请求在队列中的平均停留时间。 | **即时拥塞指标**：比 Avg Queue Size 更直观地反映对 Latency 的影响。 | `avg(sglang:avg_request_queue_latency{region=~"$region",job=~"$namespace/$app-prefill",cluster=""})` |
| PD Performance | [Decode] Queue Lantency | Decode 平均请求队列延迟 | Decode 阶段的排队时间。 | **生成阻塞**：反映 Decode 计算资源的紧缺程度。 | `avg(sglang:avg_request_queue_latency{region=~"$region",job=~"$namespace/$app-decode",cluster=""})` |
| PD Performance | [Decode] Token Usage (By DP Rank) | Decode Token 使用率（按 DP Rank 统计） | 不同 Data Parallel Rank 的显存使用情况。 | **负载偏斜**：检查是否有特定 Rank 负载过重。 | `max(sglang:token_usage{region=~"$region",job=~"$namespace/$app-decode",cluster=""}) by (region,pod,dp_rank)` |
| PD Performance | [Decode] Running Req Num (By DP Rank) | Decode 运行请求数（按 DP Rank 统计） | 不同 DP Rank 的并发数。 | **分发逻辑验证**：验证 DP 策略是否生效。 | `max(sglang:num_running_reqs{region=~"$region",job=~"$namespace/$app-decode",cluster=""}) by (region,pod,dp_rank)` |
| PD Network | Total Pod Bandwidth | 所有 Decode 和 Prefill Pod 的总带宽 | 集群内与 LLM 服务相关的所有容器网络流量总和。 | **网络大盘**：监控集群网络总负载，评估交换机/核心层压力。 | `sum(     rate(container_network_receive_bytes_total{         namespace="$namespace",         pod=~"$app-(decode\|prefill).*"     }[5m]) +     rate(container_network_transmit_bytes_total{         namespace="$namespace",         pod=~"$app-(decode\|prefill).*"     }[5m]) )` |
| PD Network | Pod Network Receive Rate | Pod 网络接收速率 | 容器网络接口（eth0）的入向流量。 | **流量分析**：Decode Pod 接收高（KV Cache），Prefill Pod 接收高（Input Data）。 | `sum(     rate(container_network_receive_bytes_total{         namespace="$namespace",         pod=~"$app-(decode\|prefill).*"     }[5m]) )` |
| PD Network | Pod Network Transmit Rate | Pod 网络发送速率 | 容器网络接口（eth0）的出向流量。 | **流量分析**：Prefill Pod 发送高（KV Cache），Decode Pod 发送高（Output Data - 较小）。 | `sum(     rate(container_network_transmit_bytes_total{         namespace="$namespace",         pod=~"$app-(decode\|prefill).*"     }[5m]) )` |
| PD Network | Pod RX/TX Ratio | Pod 接收/发送比率 (RX/TX) | 接收流量与发送流量的比值。 | **角色行为验证**：<br>1. Prefill 节点通常 TX > RX（产生 KV Cache）。<br>2. Decode 节点通常 RX > TX（接收 KV Cache）。<br>3. 比例异常说明角色分配或路由错误。 | `sum(rate(container_network_receive_bytes_total{namespace="$namespace",pod=~"$app-(decode\|prefill).*"}[5m])) / sum(rate(container_network_transmit_bytes_total{namespace="$namespace",pod=~"$app-(decode\|prefill).*"}[5m]))` |
| PD Network | Decode Pods RX Rate per Instance | Decode Pod 单实例接收速率 | 平均每个 Decode Pod 的接收带宽。 | **接收瓶颈**：若单实例打满网卡，限制扩容效果。 | `sum by (pod) (     rate(container_network_receive_bytes_total{         namespace="$namespace",         pod=~"$app-decode.*"     }[5m]) )` |
| PD Network | Decode Pods TX Rate per Instance | Decode Pod 单实例发送速率 | 平均每个 Decode Pod 的发送带宽。 | **异常流量**：通常 Decode 发送量小，若高需排查是否误传大量数据。 | `sum by (pod) (     rate(container_network_transmit_bytes_total{         namespace="$namespace",         pod=~"$app-decode.*"     }[5m]) )` |
| PD Network | Prefill Pods RX Rate per Instance | Prefill Pod 单实例接收速率 | 平均每个 Prefill Pod 的接收带宽。 | **数据加载监控**：反映 Prompt 输入的数据量。 | `sum by (pod) (     rate(container_network_receive_bytes_total{         namespace="$namespace",         pod=~"$app-prefill.*"     }[5m]) )` |
| PD Network | Prefill Pods TX Rate per Instance | Prefill Pod 单实例发送速率 | 平均每个 Prefill Pod 的发送带宽。 | **传输压力**：关键指标。若过高，需考虑增加 Prefill 节点分摊流量。 | `sum by (pod) (     rate(container_network_transmit_bytes_total{         namespace="$namespace",         pod=~"$app-prefill.*"     }[5m]) )` |
| PD Network | Decode Pods RX - Max/Avg/Mean | Decode Pods 接收速率统计 | 接收速率的统计分布（最大值、平均值）。 | **长尾问题**：Max 远大于 Avg 说明存在数据倾斜（某些 Pod 处理了超大 Context）。 | `max(     sum by (pod) (         rate(container_network_receive_bytes_total{             namespace="$namespace",             pod=~"$app-decode.*"         }[5m])     ) )` |
| PD Network | Decode Pods TX - Max/Avg/Mean | Decode Pods 发送速率统计 | 发送速率的统计分布。 | **均衡性分析**：检查发送流量是否均匀。 | `max(     sum by (pod) (         rate(container_network_transmit_bytes_total{             namespace="$namespace",             pod=~"$app-decode.*"         }[5m])     ) )` |
| PD Network | Prefill Pods RX - Max/Avg/Mean | Prefill Pods 接收速率统计 | Prefill 接收速率分布。 | **输入倾斜**：Max 高说明请求长度分布极不均匀。 | `max(     sum by (pod) (         rate(container_network_receive_bytes_total{             namespace="$namespace",             pod=~"$app-prefill.*"         }[5m])     ) )` |
| PD Network | Prefill Pods TX - Max/Avg/Mean | Prefill Pods 发送速率统计 | Prefill 发送速率分布。 | **输出热点**：Max 高可能是某个 Pod 承担了超长 Context 的 KV 传输。 | `max(     sum by (pod) (         rate(container_network_transmit_bytes_total{             namespace="$namespace",             pod=~"$app-prefill.*"         }[5m])     ) )` |
| PD Network | IB RX（Decode Scoped) | IB 接收速率（Decode 范围） | Decode 节点 RDMA/IB 网卡的接收速率。 | **RDMA 监控**：确认 KV Cache 是否走在高速 IB 网络上。 | `sum by (instance, node) (   rate(node_infiniband_port_data_received_bytes_total[1m]) ) * on (node) group_left() (   count by (node) (     kube_pod_info{       namespace="$namespace",       pod=~"$app-decode.*"     }   ) > 0 )` |
| PD Network | IB TX（Decode Scoped) | IB 发送速率（Decode 范围） | Decode 节点 RDMA/IB 网卡的发送速率。 | **ACK/控制流**：通常较低，主要用于协议交互。 | `sum by (instance, node) (   rate(node_infiniband_port_data_transmitted_bytes_total[1m]) ) * on (node) group_left() (   count by (node) (     kube_pod_info{       namespace="$namespace",       pod=~"$app-decode.*"     }   ) > 0 )` |
| PD Network | IB RX（Prefill Scoped) | IB 接收速率（Prefill 范围） | Prefill 节点 IB 接收速率。 | **RDMA 监控**：通常较低。 | `sum by (instance, node) (   rate(node_infiniband_port_data_received_bytes_total[1m]) ) * on (node) group_left() (   count by (node) (     kube_pod_info{       namespace="$namespace",       pod=~"$app-prefill.*"     }   ) > 0 )` |
| PD Network | IB TX（Prefill Scoped) | IB 发送速率（Prefill 范围） | Prefill 节点 IB 发送速率（核心数据流）。 | **物理瓶颈**：直接对照交换机端口限速。 | `sum by (instance, node) (   rate(node_infiniband_port_data_transmitted_bytes_total[1m]) ) * on (node) group_left() (   count by (node) (     kube_pod_info{       namespace="$namespace",       pod=~"$app-prefill.*"     }   ) > 0 )` |
| PD Network | IB RX/TX Ratio | IB 接收/发送比率 | IB 网络的收发比。 | **网络健康度**：极端比例可能暗示单向链路拥塞。 | `(   sum by(instance, node) (     rate(node_infiniband_port_data_received_bytes_total[1m])   )   *   on(node)   group_left()   (     count by(node) (       kube_pod_info{         namespace="$namespace",         pod=~"$app-(decode\|prefill).*"       }     ) > 0   ) ) / (   sum by(instance, node) (     rate(node_infiniband_port_data_transmitted_bytes_total[1m])   )   *   on(node)   group_left()   (     count by(node) (       kube_pod_info{         namespace="$namespace",         pod=~"$app-(decode\|prefill).*"       }     ) > 0   ) )` |
| PD Network | InfiniBand Network Transmit Wait | InfiniBand 网络发送等待 | IB 端口因拥塞控制（Head-of-Line Blocking 或 Credit 不足）而暂停发送的次数/时间。 | **网络拥塞金指标**：<br>1. **值 > 0** 意味着物理网络发生拥塞（PFC 触发）。<br>2. 需优化网络拓扑、QoS 配置或减少 Burst 流量。 | `max by (instance, node) (   rate(node_infiniband_port_transmit_wait_total[1m]) ) * on (node) group_left() (   count by (node) (     kube_pod_info{       namespace="$namespace",       pod=~"$app-decode.*"     }   ) > 0 )` |

